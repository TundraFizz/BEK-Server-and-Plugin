<!-- <script>var yolo = "Fek";var swag = "Account";</script> -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>TBD</title>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta name="author"      content="Tundra Fizz"/>

    <link rel="shortcut icon" href="icon/icon.jpg"/>                          <!-- Icon     -->
    <!-- <link rel="stylesheet"    href="css/bootstrap/bootstrap.css"/>            <!-- Bootstrap Core CSS -->
    <!-- <link rel="stylesheet"    href="css/misc/style.css?v=7" type="text/css"/> <!-- Custom CSS         -->

    <script src="js/jquery/jquery-2.1.4.js"></script>       <!-- jQuery                     -->
    <script src="js/jquery/jquery-ui.js"></script>          <!-- jQuery                     -->
    <script src="js/canvas/canvasjs.js"></script>           <!-- Draws graphs               -->
    <script src="js/jquery/jquery.tablesorter.js"></script> <!-- Allows tables to be sorted -->
    <script src="js/bootstrap/bootstrap.min.js"></script>   <!-- Bootstrap Core JavaScript  -->
    <script src="js/misc/tundra.js"></script>               <!-- My custom JavaScript       -->
  </head>

  <body>
    <div class="container-fluid">
    <div class="row">
      <div class="col-sm-12">
        <table id="myTable" border="0">
        <tr>
          <td colspan="3">
            <input type="button" id="btnAddRow" value="Add row">
            <input type="button" id="btnSubmit" value="Submit">
          </td>
        </tr>
        </table>
      </div>
    </div>
    </div>
  </body>
</html>

<script>

$(function(){
  AddRow();
});

$("#btnAddRow").click(function(){
  AddRow();
});

$("#btnSubmit").click(function(){
  $("tr").slice(1).each(function(){
    var formData = new FormData();
    var self     = this;
    var name     = $("[data=name]",   this).val();
    var region   = $("[data=region]", this).val();
    var file     = $("[data=avatar]", this).get(0).files[0];

    // Skip this row if it's disabled or has no file
    var isDisabled = $("[data=name]", this).prop("disabled");
    var noFile     = (typeof file === "undefined");
    if(isDisabled || noFile)
      return true;

    formData.append("name", name);
    formData.append("region", region);
    formData.append("file", file, file.name);

    $.ajax({
      url: "uploadavatar",
      type: "POST",
      data: formData,
      contentType: false,
      processData: false
    }).done(function(data){
      if(data["uploaded"]){
        $("[data=name]",   self).prop("disabled", true);
        $("[data=region]", self).prop("disabled", true);
        $("[data=avatar]", self).prop("disabled", true);
      }
    });
  });
});

function AddRow(){
  AddRow.row = ++AddRow.row || 0;
  var row = AddRow.row;

  $("#myTable").append(`
  <tr>
    <td><input data="name" type="text"></td>
    <td>
      <select data="region">
        <option value="NA">NA</option>
        <option value="OCE">OCE</option>
        <option value="EUW">EUW</option>
        <option value="EUNE">EUNE</option>
      </select>
    </td>
    <td>
      <label for="av${row}" class="button">Upload Files</label>
      <input  id="av${row}" data="avatar" type="file" name="file">
    </td>
  </tr>`);
}

</script>
<!-- <label for="upload_files" class="button">Upload Files</label> -->
<!-- <input id ="upload_files" type="file" name="files"> -->
